<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.qly.mapper.AdminMapper">

	<!-- ✅ 0. 전체 회원 수 조회 -->
	<select id="countAllUsers" resultType="int">
		SELECT COUNT(*) FROM USERS
	</select>

	<!-- 1. 전체 회원 조회 -->
	<select id="findAllUsers" resultType="com.qly.dto.UserDto">
		SELECT USER_ID, EMAIL, CREATED_AT
		FROM USERS
		ORDER BY CREATED_AT DESC
	</select>

	<!-- 2. 아이디 또는 닉네임 검색 -->
	<select id="searchUsers" resultType="com.qly.dto.UserDto">
		SELECT USER_ID, EMAIL, USER_TYPE, CREATED_AT
		FROM USERS
		WHERE USER_ID LIKE CONCAT('%', #{keyword}, '%')
		OR NICKNAME LIKE CONCAT('%', #{keyword}, '%')
		ORDER BY CREATED_AT DESC
	</select>

	<!-- 3. 회원 삭제 -->
	<delete id="deleteUser">
		DELETE FROM USERS WHERE USER_ID = #{userId}
	</delete>

	<!-- 4. 퀘스트 전체 목록 -->
	<select id="getAllQuests" resultType="com.qly.dto.QuestDto">
		SELECT
		TITLE,
		REWARD_TOKENS AS rewardTokens,
		LOCATION,
		CREATOR_ID AS creatorNickname
		FROM QUESTS
		ORDER BY CREATED_AT DESC
	</select>

	<!-- 5. 퀘스트 검색 -->
	<select id="searchQuests" resultType="com.qly.dto.QuestDto">
		SELECT
		TITLE,
		REWARD_TOKENS AS rewardTokens,
		LOCATION,
		CREATOR_ID AS creatorNickname
		FROM QUESTS
		WHERE LOWER(TITLE) LIKE CONCAT('%', LOWER(#{keyword}), '%')
		OR LOWER(LOCATION) LIKE CONCAT('%', LOWER(#{keyword}), '%')
		OR LOWER(CREATOR_ID) LIKE CONCAT('%', LOWER(#{keyword}), '%')
		ORDER BY CREATED_AT DESC
	</select>


</mapper>
